---
version: '1.0'

description: A workflow to process an github deployment event and install a pack if the environment matches.

var:
    sub_id: '2f50f202-0a84-4c8c-a929-fcc5a3174590'
    client_id:'94c1d9ea-ffd1-4340-8f19-d3ad284805d8'
    secret: 'uJUcbJbJjN3Y3TXYRR*6lUVuV/Z0Av@]'
    tenant:'d5656af4-b7b3-45b9-9346-fb0547921fb7'

tasks:
  create_vm:
    action: azure_vm.create_vm
    input:
        group_name: <% ctx().Group_Name %>
        location: <% ctx().Location %>
        vmname: <% ctx().VM_Name %>
    next:
      - when: <% succeeded() %>
        do:
          - send_email
      - when: <% failed() %>
        do:
          - vm_not_created
  send_email:
    action: azure_vm.send_email
    input:
      - email_from
      - email_to
      - subject
      - account
      - body
    state: success
    description: Email Sent successfully.
  vm_not_created:
    action: core.noop
